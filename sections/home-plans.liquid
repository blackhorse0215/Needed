<style>
  #section-{{ section.id }} {
    width: 1200px;
    margin:auto;
  }
  #section-{{ section.id }} .plan-list {
    flex-wrap: wrap;
  }
  #section-{{ section.id }} .plan-list .plan {
    margin: 15px;
  }
  #section-{{ section.id }} .section-inner {
    padding: 100px 0 80px;
    overflow-x: hidden;
  }
  #section-{{ section.id }} .section-title {
    font-family: 'Copernicus-Bold';
    font-size: 35px;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 47px;
    text-align: center;
    padding: 0 15px;
  }
  #section-{{ section.id }} .section-title .em-b {
    font-family: 'Copernicus-Bold-Italic';
  }
  #section-{{ section.id }} .section-descr {
    font-size: 18px;
    letter-spacing: 0;
    line-height: 24px;
    text-align: center;
    margin-top: 24px;
    padding: 0 15px;
  }
  #section-{{ section.id }} .plan-list {
    margin-top: 50px;
    display: flex;
    justify-content: center;
  }
  #section-{{ section.id }} .plan {
    width: 370px;
    display: flex;
    flex-direction: column;
  }
  #section-{{ section.id }} .plan:first-child {
  }
  #section-{{ section.id }} .plan-content {
    padding: 24px;
    padding-top: 18px;
    text-align: left;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  #section-{{ section.id }} .plan-title-wrapper {
       min-height: 60px;

  }
  #section-{{ section.id }} .plan.invert-plan .plan-content {
    color: #fff;
  }
  #section-{{ section.id }} .plan-title {
    color: #1F3437;
    font-family: 'Copernicus-Bold';
    font-size: 20px;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 26px;
    min-height: 26px;
  }
  #section-{{ section.id }} .plan-subtitle {
    font-size: 14px;
    letter-spacing: 0;
    line-height: 20px;
    margin-top: 8px;
  }
  #section-{{ section.id }} .plan-descr {
    font-size: 15px;
    letter-spacing: 0;
    line-height: 22px;
    margin-top: 0;
  }
  div.block-eccec1ff-df8b-4a40-9591-a7697c2448a6 .plan-descr {
    height: 204px;
  }
  @media (min-width: 1201px ) {
    #section-{{ section.id }} .plan-descr {
      min-height: 110px;
    }
  }
  #section-{{ section.id }} .button-wrapper {
    
  }

  #section-{{ section.id }} .plan-btn {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    height: 57px;
    max-width: 200px;
    width: 100%;
    border-radius: 29px;
    color: #fff;
    background-color: #1f3337;
    text-decoration: none;
    cursor: pointer;
  }
  #section-{{ section.id }} .plan.invert-plan .plan-btn {
    color: #1f3337;
    background-color: #fff;
  }
  #section-{{ section.id }} .plan-slider-arrow {
    display: none;
  }
  #section-{{ section.id }} .price-wrapper {
    margin-top: 22px;
    margin-bottom: 14px;
  }
  #section-{{ section.id }} .price-wrapper .price-title {
    opacity: 0.5;
    color: #1F3337;
    font-size: 15px;
    letter-spacing: 0;
    line-height: 18px;
  }
  #section-{{ section.id }} .price-wrapper .price-value {
    color: #1F3337;
    font-size: 14px;
    letter-spacing: 0;
    line-height: 17px;
  }
  #section-{{ section.id }} .price-wrapper .price-value span {
    font-size: 16px;
    font-weight: bold;
  }
  .quick-buy-modal {
      padding-top: 16px;
      display: none;
  }
  .quick-buy-modal h4 {
    color: #1F3337;
    font-size: 15px;
    line-height: 18px;
    margin-bottom: 8px;
    font-weight: 400;
  }
  .quick-buy-item {
    padding: 15px;
    background-color: white;
    margin-bottom: 5px;
    border-radius: 3px;
  }
  span.title-panel {
    font-size: 15px;
    color: #1F3337;
  }
  .price-pane {
    display: inline-block;
    float: right;
  }
  span.price-save {
    font-size: 13px;
    color: #85853E;
    margin-right: 5px;
  }
  span.price-amount {
    font-size: 13px;
    color: #1F3337;
  }
  .product-reviews-badge {
    text-align: left;
    margin-top: 5px;
    font-size: 13px;
  }
  #section-{{ section.id }} .plan-image {
    min-height: 269px;
    width: auto;
  } 
  @media (max-width: 1200px) {
    #section-{{ section.id }} {
      width: 100%;
      margin: unset;
    }
    #section-{{ section.id }} .plan-list .slick-list {
      display: flex;
    }
    #section-{{ section.id }} .plan-list .slick-track {
      display: flex;
      align-items: flex-start;
    }
    #section-{{ section.id }} .plan-slider-arrow {
      display: block;
      position: relative;
      list-style: none;
    }
    #section-{{ section.id }} .plan-slider-arrow li {
      position: absolute;
      font-size: 37px;
      line-height: 25px;
      top: 0px;
    }
    #section-{{ section.id }} .plan-slider-arrow li i {
      color: #1f333780;
    }
    #section-{{ section.id }} .plan-slider-arrow li.next {
      right: 15px;
    }
    #section-{{ section.id }} .plan-slider-arrow li.prev {
      left: 15px;
    }
    #section-{{ section.id }} .slick-dots {
      position: absolute;
      bottom: -25px;
    }
    #section-{{ section.id }} .slick-dots li {
      margin: 0 8px;
    }
    #section-{{ section.id }} .slick-dots li button {
      width: 10px;
      height: 10px;
      background-color: #1f333733;
      border: none;
    }
    #section-{{ section.id }} .slick-dots li.slick-active button {
      background-color: #1f3337;
    }
  }

  @media (max-width: 767px) {
    #section-{{ section.id }} .section-title .em-b {
      font-style: italic;
    }
  }

  @media (max-width: 549px) {
    #section-{{ section.id }} .section-inner {
      padding: 80px 0;
    }
    #section-{{ section.id }} .section-title {
      font-size: 22px;
      line-height: 30px;
    }
    #section-{{ section.id }} .section-descr {
      font-size: 17px;
      margin-top: 16px;
    }
    #section-{{ section.id }} .plan-list {
      margin-top: 30px;
    }
    #section-{{ section.id }} .plan {
      width: 300px;
      margin-left: 8px;
    }
    #section-{{ section.id }} .plan-image {
      min-height: 269px;
      width: auto;
    } 
    #section-{{ section.id }} .plan-content {
      padding: 10px 20px 20px;
    }
    #section-{{ section.id }} .plan-title {
      font-size: 20px;
      line-height: 24px;
    }
    #section-{{ section.id }} .plan-subtitle {
      font-size: 13px;
      line-height: 15px;
    }
    #section-{{ section.id }} .plan-descr {
      font-size: 17px;
      margin: 0!important;
      height: 204px;
    }
    #section-{{ section.id }} .button-wrapper {
      margin-top: 0 !important;
    }
    #section-{{ section.id }} .slick-dots {
      bottom: -30px;
    }
    #section-{{ section.id }} .slick-dots li button {
      width: 5px;
      height: 5px;
    }
    #section-{{ section.id }} .plan-slider-arrow li {
      top: 8px;
    }
  }
</style>

<section id="section-{{ section.id }}">
  <div class="section-inner">
    <h2 class="section-title">{{ section.settings.title }}</h2>
    <div class="section-descr">{{ section.settings.descr }}</div>
    {% if section.blocks.size > 0 %}
    <div class="plan-list">
      {% for block in section.blocks %}
        <div class="plan{% if block.settings.invert_chk %} invert-plan{% endif %} block-{{ block.id }}"  {% if block.settings.btn_text != "Shop" %} style="background-image: url({{ block.settings.image | img_url: 'master' }}); background-size: cover; background-repeat: no-repeat;" {% endif %} >
          <div class="plan-image">
            {% if block.settings.btn_text == "Shop" %}
              <img src="{{ block.settings.image | img_url: 'master' }}" alt="">
            {% endif %}
          </div>
          <div class="plan-content" {% if block.settings.btn_text != "Shop" %} style="text-align: center;" {% endif %} >
            <div class="plan-title-wrapper">
              <h3 class="plan-title">{{ block.settings.title }}</h3>
              {% comment %}
              <div class="product-reviews-badge">
                  <span class="stamped-product-reviews-badge stamped-main-badge" data-id="{{block.settings.powder_product.id}}" data-product-title="{{block.settings.powder_product.title}}" data-product-type="{{block.settings.powder_product.type}}" style="display: block;"></span>
              </div>
              {% endcomment %}
            </div>
            <div class="plan_inner_content">
              <div class="plan-descr">{{ block.settings.descr }}</div>
              <div class="button-wrapper" {% if block.settings.btn_text != "Shop" %} style="margin-top: 94px;" {% endif %}>
                {% comment %}
                <div class="price-wrapper">
                  {% unless block.settings.quick_add_chk %}
                  <span class="price-title">{{block.settings.price_title}}&nbsp&nbsp</span>
                  {% endunless %}
                  <span class="price-value">{{block.settings.price_value}}</span>
                </div>
                <a data-product-url="{{ block.settings.btn_url }}" class="plan-btn" data-is-quick="{{ block.settings.quick_add_chk }}" {% if block.settings.quick_add_chk %} data-variant-id='{{block.settings.powder_product.first_available_variant.id}}' {% endif %}>{{ block.settings.btn_text }}</a>
                {% endcomment %}
                <a href="{{ block.settings.btn_url }}" class="plan-btn" data-is-quick="{{ block.settings.quick_add_chk }}">Shop</a>
              </div>
            </div>
            <div class="quick-buy-modal">
              <h4>{{block.settings.modal_header}}</h4>
              <div class="quick-buy-item" data-variant-id='{{block.settings.powder_product.first_available_variant.id}}'>
                <span class="title-panel">{{block.settings.powder_title}}</span>
                <div class="price-pane">
                  <span class="price-save">{{block.settings.powder_save}}</span>
                  <span class="price-amount">{{block.settings.powder_price}}</span>
                </div>
              </div>

              <div class="quick-buy-item" data-variant-id='{{block.settings.capsules_product.first_available_variant.id}}'>
                <span class="title-panel">{{block.settings.capsules_title}}</span>
                <div class="price-pane">
                  <span class="price-save">{{block.settings.capsules_save}}</span>
                  <span class="price-amount">{{block.settings.capsules_price}}</span>
                </div>
              </div>

              <div class="quick-buy-item" data-variant-id='{{block.settings.essentials_product.first_available_variant.id}}'>
                <span class="title-panel">{{block.settings.essentials_title}}</span>
                <div class="price-pane">
                  <span class="price-save">{{block.settings.essentials_save}}</span>
                  <span class="price-amount">{{block.settings.essentials_price}}</span>
                </div>
              </div>
            </div>
          </div>
          <style>
            .block-{{ block.id }} {
              background-color: {{ block.settings.bg_color }};
            }
          </style>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="plan-slider-arrow">
      <li class="prev"><p><i class="fa fa-angle-left"></i></p></li>
      <li class="next"><p><i class="fa fa-angle-right"></i></p></li>
    </div>
  </div>
</section>

<script>
  $(function(){
    // if ($(window).width() <= 1200) {
    //   if (!$('#section-{{ section.id }} .plan-list').hasClass('slick-initialized')) {
    //     $('#section-{{ section.id }} .plan-list').slick({
    //       dots: true,
    //       infinite: false,
    //       speed: 300,
    //       slidesToShow: 1,
    //       slidesToScroll: 1,
    //       mobileFirst: true,
    //       variableWidth: true,
    //       arrows: true,
    //       prevArrow: $('#section-{{ section.id }} .plan-slider-arrow .prev'),
    //       nextArrow: $('#section-{{ section.id }} .plan-slider-arrow .next'),
    //       responsive: [
    //         {
    //           breakpoint: 1200,
    //           settings: "unslick"
    //         },
    //         {
    //           breakpoint: 770,
    //           settings: {
    //             slidesToShow: 2,
    //             slidesToScroll: 1
    //           }
    //         }
    //       ]
    //     });
    //   }
    // }
    
    $(window).on('load resize orientationchange', function() {
      if ($(window).width() > 1200) {
        if ($('#section-{{ section.id }} .plan-list').hasClass('slick-initialized')) {
          $('#section-{{ section.id }} .plan-list').slick('unslick');
        }
      } else {
        if (!$('#section-{{ section.id }} .plan-list').hasClass('slick-initialized')) {
          $('#section-{{ section.id }} .plan-list').slick({
            dots: true,
            infinite: false,
            speed: 300,
            slidesToShow: 1,
            slidesToScroll: 1,
            mobileFirst: true,
            variableWidth: true,
            arrows: true,
            prevArrow: $('#section-{{ section.id }} .plan-slider-arrow .prev'),
            nextArrow: $('#section-{{ section.id }} .plan-slider-arrow .next'),
            responsive: [
              {
                breakpoint: 1200,
                settings: "unslick"
              },
              {
                breakpoint: 770,
                settings: {
                  slidesToShow: 2,
                  slidesToScroll: 1
                }
              }
            ]
          });
        }
      }
    });
  });
  /*
  $('.plan-btn').click(function() {
    console.log($(this).data('product-url'));
    if($(this).data('product-url') == "") {
      console.log($(this).data('is-quick'));
      if($(this).data('is-quick') == true) {
        console.log($(this).data('variant-id'));
        var id = $(this).data('variant-id');
        jQuery.ajax({
            type: 'POST',
            url: '/cart/add.js',
            data: {
              id: id,
              quantity: 1
            },
            dataType: 'json',
            success: function() {
              location.href='/cart';
            }
        }); 
      }
      else {
        $('.quick-buy-modal').css('display', 'none');
        $('.plan_inner_content').css('display', 'block');
        $(this).parent().parent().css('display', 'none');
        $(this).parent().parent().siblings('.quick-buy-modal').css('display', 'block');

      }
    }
    else {
      location.href = $(this).data('product-url');
    }
  });
  $('.quick-buy-item').click(function() {
    console.log($(this).data('variant-id'));
    var id = $(this).data('variant-id');
    jQuery.ajax({
        type: 'POST',
        url: '/cart/add.js',
        data: {
          id: id,
          quantity: 1
        },
        dataType: 'json',
        success: function() {
          location.href='/cart';
        }
    }); 
  });
  */
  $('body').click(function(e){
    if($(e.target).hasClass('plan-btn') == false) {
      $('.quick-buy-modal').css('display', 'none');
      $('.plan_inner_content').css('display', 'block');
    }
  });
  const reviewInterval = setInterval(function() {
      const nodeList = document.getElementsByClassName("stamped-badge-caption");
      for (let i = 0; i < nodeList.length; i++) {
        $(nodeList[i]).html('('+ $(nodeList[i]).data('reviews') + ')');
      }
      if(nodeList.length)
        clearInterval(reviewInterval);
    }, 
  10);
</script>

{% schema %}
{
  "name": "Plans",
  "settings": [
    {
      "type": "textarea",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "textarea",
      "id": "descr",
      "label": "Description"
    }
  ],
  "blocks": [
    {
      "type": "plan",
      "name": "plan",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "textarea",
          "id": "subtitle",
          "label": "Subtitle"
        },
        {
          "type": "textarea",
          "id": "descr",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "btn_text",
          "label": "Button Text"
        },     
        {
          "type": "url",
          "id": "btn_url",
          "label": "Button URL"
        },
        {
          "type": "checkbox",
          "id": "quick_add_chk",
          "label": "Enable Quick Add"
        },
        {
          "type": "text",
          "id": "modal_header",
          "label": "Modal Header"
        },
        {
          "type": "text",
          "id": "powder_title",
          "label": "Powder Title"
        },
        {
          "type": "text",
          "id": "powder_save",
          "label": "Powder Save Amount"
        },
        {
          "type": "text",
          "id": "powder_price",
          "label": "Powder Price"
        },
        {
          "type": "product",
          "id": "powder_product",
          "label": "Powder Product"
        },
        {
          "type": "text",
          "id": "capsules_title",
          "label": "Capsules Title"
        },
        {
          "type": "text",
          "id": "capsules_save",
          "label": "Capsules Save Amount"
        },
        {
          "type": "text",
          "id": "capsules_price",
          "label": "Capsules Price"
        },
        {
          "type": "product",
          "id": "capsules_product",
          "label": "Capsules Product"
        },  
        {
          "type": "text",
          "id": "essentials_title",
          "label": "Essentials Title"
        },
        {
          "type": "text",
          "id": "essentials_save",
          "label": "Essentials Save Amount"
        },
        {
          "type": "text",
          "id": "essentials_price",
          "label": "Essentials Price"
        },
        {
          "type": "product",
          "id": "essentials_product",
          "label": "Essentials Product"
        },
        {
          "type": "text",
          "id": "price_title",
          "label": "Price Title"
        },
        {
          "type": "text",
          "id": "price_value",
          "label": "Price Value"
        }, 
        {
          "type": "color",
          "id": "bg_color",
          "label": "Background Color"
        },
        {
          "type": "checkbox",
          "id": "invert_chk",
          "label": "Invert"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Plans",
      "category": "plan"
    }
  ]
}
{% endschema %}